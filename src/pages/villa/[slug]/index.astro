---
import { Image } from "astro:assets";
import Buildings from "../../../components/detail-villa/buildings.astro";
import Facilities from "../../../components/detail-villa/facilities.astro";
import Galleries from "../../../components/detail-villa/galleries.astro";
import Hero from "../../../components/detail-villa/hero.astro";
import Lightbox from "../../../components/detail-villa/lightbox.astro";
import Pricings from "../../../components/detail-villa/pricings.astro";
import Select from "../../../components/detail-villa/select.astro";
import Tab from "../../../components/detail-villa/tab.astro";
import TermsAndCondition from "../../../components/detail-villa/terms-and-condition.astro";
import Footer from "../../../components/footer.astro";
import Navbar from "../../../components/navbar.astro";
import RootLayout from "../../../layouts/root-layout.astro";
import { ListVilla, VillaMap } from "../../../shared/data/villas";
import type { Villa } from "../../../shared/types";
import Contacts from "../../../components/detail-villa/contacts.astro";

// We still keep per-slug routes for canonical URLs (good for SEO & shareability)
export const prerender = true;

export function getStaticPaths() {
  return [
    { params: { slug: "garuda" } },
    { params: { slug: "kaluska" } },
    // { params: { slug: 'alika' } }, // currently unavailable
    // { params: { slug: 'lagogo' } }, // currently unavailable
    { params: { slug: "sari" } },
  ];
}

const urlSlug = Astro.params.slug as Villa["slug"];

const slugs = ListVilla.map((v) => v.slug);

const defaultSlug = ListVilla.find((v) => v.isAvailable)?.slug ?? slugs[0];

const activeSlug = slugs.includes(urlSlug) ? urlSlug : defaultSlug;
---

<RootLayout
  title={VillaMap[activeSlug].name + " - Lima Villa Ku"}
  description={VillaMap[activeSlug].description}
>
  <Navbar />

  <section
    class="p-6 lg:p-25 pt-[6.75rem] lg:pt-[13rem] flex flex-col items-center justify-start gap-y-20"
  >
    <h3
      class="text-2xl lg:text-4xl font-bold text-black w-full lg:w-1/2 text-center"
    >
      Pilih Villa yang Sesuai dengan Gaya Liburan Anda
    </h3>

    <div class="w-full gap-y-6 flex flex-col items-center justify-center">
      <Select activeSlug={activeSlug} />

      <Tab />

      {
        ListVilla.map((villa) => (
          <div
            class="villa-panel relative w-full h-[20rem] lg:h-[40rem] rounded-3xl bg-gray-200"
            data-panel={villa.slug}
            data-active={villa.slug === activeSlug ? "true" : "false"}
            aria-hidden={villa.slug === activeSlug ? "false" : "true"}
          >
            <Image
              id={`villa-${villa.slug}`}
              src={villa.imageUrl}
              alt={`${villa.name} Cover Image`}
              loading="eager"
              class="w-full h-full object-cover rounded-3xl"
            />
            <div class="absolute top-0 left-0 w-full h-full rounded-3xl bg-black/35" />
          </div>
        ))
      }
    </div>
  </section>

  <section>
    {
      ListVilla.map((villa) => (
        <article
          id={`villa-${villa.slug}`}
          class="villa-panel p-6 lg:p-25 flex-col lg:flex-row lg:items-start lg:justify-center space-y-8 lg:gap-x-20"
          data-panel={villa.slug}
          data-active={villa.slug === activeSlug ? "true" : "false"}
          aria-hidden={villa.slug === activeSlug ? "false" : "true"}
        >
          <div class="space-y-8">
            <Hero villa={villa} />

            <Facilities villa={villa} />

            <Buildings villa={villa} />

            <Galleries villa={villa} />

            <TermsAndCondition villa={villa} />
          </div>

          <div class="space-y-8 sticky top-36 shrink-0 lg:w-1/3">
            <Pricings villa={villa} />

            <Contacts villa={villa} />
          </div>
        </article>
      ))
    }

    <Lightbox />
  </section>

  <Footer />
</RootLayout>

<style>
  /* Hide inactive panels (still in DOM for SEO) */
  .villa-panel {
    display: none;
  }

  .villa-panel[data-active="true"] {
    display: flex;
  }

  @media (max-width: 768px) {
    .villa-panel {
      display: none;
    }
    .villa-panel[data-active="true"] {
      display: block;
    }
  }
</style>
